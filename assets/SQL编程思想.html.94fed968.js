import{_ as t,e as n}from"./app.340c2b94.js";var e="/blog-vuepress/assets/SQL\u7F16\u7A0B\u601D\u60F3-\u9762\u96BE\u9898-\u67E5\u627E\u5BC6\u63A51.11a7437a.png";const a={},s=n(`<h1 id="sql-\u7F16\u7A0B\u601D\u60F3" tabindex="-1"><a class="header-anchor" href="#sql-\u7F16\u7A0B\u601D\u60F3" aria-hidden="true">#</a> SQL \u7F16\u7A0B\u601D\u60F3</h1><h2 id="\u5458\u5DE5\u8003\u52E4\u8BB0\u5F55" tabindex="-1"><a class="header-anchor" href="#\u5458\u5DE5\u8003\u52E4\u8BB0\u5F55" aria-hidden="true">#</a> \u5458\u5DE5\u8003\u52E4\u8BB0\u5F55</h2><blockquote><p>\u516C\u53F8\u89C4\u5B9A\u5468\u4E00\u5230\u5468\u4E94\uFF08\u8282\u5047\u65E5\u9664\u5916\uFF09\u6BCF\u5929\u65E9\u4E0A\u4E5D\u70B9\u4E0A\u73ED\uFF0C\u4E0B\u5348\u516D\u70B9\u4E0B\u73ED\uFF0C\u4E0A\u4E0B\u73ED\u90FD\u9700\u8981\u6253\u5361\u3002\u65E5\u5386\u4FE1\u606F\u5B58\u50A8calendar\u8868\u4E2D\uFF0C\u5458\u5DE5\u7684\u6253\u5361\u8BB0\u5F55\u5B58\u50A8\u5728attendance\u8868\u4E2D\uFF1A</p></blockquote><table><thead><tr><th style="text-align:center;">id</th><th style="text-align:center;">check_date</th><th style="text-align:center;">emp_id</th><th style="text-align:center;">clock_in</th><th style="text-align:center;">clock_out</th></tr></thead><tbody><tr><td style="text-align:center;">1</td><td style="text-align:center;">2022-04-17</td><td style="text-align:center;">1</td><td style="text-align:center;">2022-04-17 08:34:02</td><td style="text-align:center;">2022-04-17 18:32:03</td></tr><tr><td style="text-align:center;">2</td><td style="text-align:center;">2022-04-17</td><td style="text-align:center;">2</td><td style="text-align:center;">2022-04-17 08:10:03</td><td style="text-align:center;">2022-04-17 19:31:02</td></tr><tr><td style="text-align:center;">3</td><td style="text-align:center;">2022-04-17</td><td style="text-align:center;">3</td><td style="text-align:center;">2022-04-17 08:55:08</td><td style="text-align:center;">2022-04-17 18:33:02</td></tr><tr><td style="text-align:center;">...</td><td style="text-align:center;">...</td><td style="text-align:center;">...</td><td style="text-align:center;">...</td><td style="text-align:center;">...</td></tr></tbody></table><p>HR\u60F3\u8981\u7EDF\u8BA12022\u5E744\u6708\u4EFD\u7684\u5458\u5DE5\u7F3A\u52E4\u8BB0\u5F55\uFF0C\u8BF7\u95EE\u5982\u4F55\u901A\u8FC7SQL\u67E5\u8BE2\u76F8\u5173\u8BB0\u5F55\uFF1F</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> c<span class="token punctuation">.</span>calendar_date<span class="token punctuation">,</span> e<span class="token punctuation">.</span>emp_name<span class="token punctuation">,</span> a<span class="token punctuation">.</span>clock_in<span class="token punctuation">,</span> a<span class="token punctuation">.</span>clock_out<span class="token punctuation">,</span>
			 <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> a<span class="token punctuation">.</span>clock_out <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token string">&quot;\u7F3A\u52E4&quot;</span>
			 			<span class="token keyword">WHEN</span> EXTRACT<span class="token punctuation">(</span><span class="token keyword">HOUR</span> <span class="token keyword">FROM</span> a<span class="token punctuation">.</span>clock_in<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">9</span> <span class="token keyword">THEN</span> <span class="token string">&quot;\u8FDF\u5230&quot;</span>
			 			<span class="token keyword">ELSE</span> <span class="token string">&quot;\u65E9\u9000&quot;</span>
			 <span class="token keyword">END</span> <span class="token keyword">AS</span> <span class="token string">&quot;\u8003\u52E4\u72B6\u6001&quot;</span>
<span class="token keyword">FROM</span> calendar c
<span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> employee e
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> attendance a
<span class="token keyword">ON</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>check_date <span class="token operator">=</span> c<span class="token punctuation">.</span>calendara_date <span class="token operator">AND</span> a<span class="token punctuation">.</span>emp_id <span class="token operator">=</span> e<span class="token punctuation">.</span>emp_id<span class="token punctuation">)</span>
<span class="token keyword">WHERE</span> c<span class="token punctuation">.</span>calendar_year <span class="token operator">=</span> <span class="token number">2021</span> <span class="token operator">AND</span> c<span class="token punctuation">.</span>calendar_month <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">AND</span> c<span class="token punctuation">.</span>is_work_day <span class="token operator">=</span> <span class="token string">&#39;Y&#39;</span>
<span class="token operator">AND</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>id <span class="token operator">IS</span> <span class="token boolean">NULL</span>
     <span class="token operator">OR</span> a<span class="token punctuation">.</span>clock_out <span class="token operator">IS</span> <span class="token boolean">NULL</span>
     <span class="token operator">OR</span> EXTRACT<span class="token punctuation">(</span><span class="token keyword">HOUR</span> <span class="token keyword">FROM</span> a<span class="token punctuation">.</span>clock_in<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">9</span>
     <span class="token operator">OR</span> EXTRACT<span class="token punctuation">(</span><span class="token keyword">HOUR</span> <span class="token keyword">FROM</span> a<span class="token punctuation">.</span>clock_out<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="case-\u6761\u4EF6\u8868\u8FBE\u5F0F" tabindex="-1"><a class="header-anchor" href="#case-\u6761\u4EF6\u8868\u8FBE\u5F0F" aria-hidden="true">#</a> CASE \u6761\u4EF6\u8868\u8FBE\u5F0F</h2><blockquote><p>\u516C\u53F8\u5373\u5C06\u6210\u7ACB 20 \u5468\u5E74\uFF0C\u6253\u7B97\u7ED9\u5168\u4F53\u5458\u5DE5\u53D1\u653E\u4E00\u4E2A\u5468\u5E74\u5E86\u793C\u54C1\u3002</p><p>\u53D1\u653E\u793C\u54C1\u7684\u89C4\u5219\u5982\u4E0B\uFF1A</p><ul><li>\u622A\u6B62 2020 \u5E74\u5165\u804C\u5E74\u9650\u4E0D\u6EE1 10 \u5E74\u7684\u5458\u5DE5\uFF0C\u7537\u6027\u5458\u5DE5\u7684\u793C\u54C1\u4E3A\u624B\u8868\u4E00\u5757\uFF0C\u5973\u6027\u5458\u5DE5\u7684\u793C\u54C1\u4E3A\u5316\u5986\u54C1\u4E00\u5957\uFF1B</li><li>\u622A\u81F3 2020 \u5E74\u5165\u804C\u5E74\u9650\u6EE1 10 \u5E74\u4E0D\u6EE1 15 \u5E74\u7684\u5458\u5DE5\uFF0C\u7537\u6027\u5458\u5DE5\u7684\u793C\u54C1\u4E3A\u624B\u673A\u4E00\u90E8\uFF0C\u5973\u6027\u7684\u793C\u54C1\u4E3A\u9879\u94FE\u4E00\u6761</li><li>\u622A\u81F3 2020 \u5E74\u5165\u804C\u5E74\u9650\u6EE1 15 \u5E74\u7684\u5458\u5DE5\uFF0C\u4E0D\u8BBA\u7537\u5973\u793C\u54C1\u7EDF\u4E00\u4E3A\u7535\u8111\u4E00\u53F0</li></ul><p>\u73B0\u5728\u4EBA\u4E8B\u90E8\u95E8\u9700\u8981\u6307\u5BFC\u4E3A\u6BCF\u4F4D\u5458\u5DE5\u53D1\u653E\u4EC0\u4E48\u793C\u54C1\uFF0C\u5982\u4F55\u901A\u8FC7SQL\u67E5\u8BE2\u5F97\u5230\u8FD9\u4E9B\u4FE1\u606F\uFF1F</p></blockquote><p>\u5458\u5DE5\u4FE1\u606F\u8868\uFF1Aemp_id, amp_name, sex, dept_id, manager, hire_date, job_id, salary, bonus, emails</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>SELECT emp_name, sex, hire_date,
			 CASE
				 WHEN extract(year FROM hire_date) &gt; 2011 AND sex = &#39;\u7537&#39; THEN &#39;\u624B\u8868&#39;
				 WHEN extract(year FROM hire_date) &gt; 2011 AND sex = &#39;\u5973&#39; THEN &#39;\u5316\u5986\u54C1&#39;
				 WHEN extract(year FROM hire_date) &gt; 2006 AND sex = &#39;\u7537&#39; THEN &#39;\u624B\u673A&#39;
				 WHEN extract(year FROM hire_date) &gt; 2006 AND sex = &#39;\u5973&#39; THEN &#39;\u9879\u94FE&#39;
				 ELSE &#39;\u7535\u8111&#39;
			 END AS &quot;\u793C\u54C1&quot;
FROM employee;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="\u6570\u636E\u62A5\u8868\u884C\u5217\u8F6C\u6362" tabindex="-1"><a class="header-anchor" href="#\u6570\u636E\u62A5\u8868\u884C\u5217\u8F6C\u6362" aria-hidden="true">#</a> \u6570\u636E\u62A5\u8868\u884C\u5217\u8F6C\u6362</h2><blockquote><p>\u5B66\u751F\u6210\u7EE9\u8BB0\u5F55\u8868\u5305\u542B\u4EE5\u4E0B\u4FE1\u606F</p></blockquote><table><thead><tr><th style="text-align:center;">sname</th><th style="text-align:center;">cname</th><th style="text-align:center;">grade</th></tr></thead><tbody><tr><td style="text-align:center;">\u5F20\u4E09</td><td style="text-align:center;">\u8BED\u6587</td><td style="text-align:center;">80</td></tr><tr><td style="text-align:center;">\u674E\u56DB</td><td style="text-align:center;">\u8BED\u6587</td><td style="text-align:center;">77</td></tr><tr><td style="text-align:center;">\u738B\u4E94</td><td style="text-align:center;">\u8BED\u6587</td><td style="text-align:center;">91</td></tr><tr><td style="text-align:center;">\u5F20\u4E09</td><td style="text-align:center;">\u6570\u5B66</td><td style="text-align:center;">85</td></tr><tr><td style="text-align:center;">\u674E\u56DB</td><td style="text-align:center;">\u6570\u5B66</td><td style="text-align:center;">90</td></tr><tr><td style="text-align:center;">\u738B\u4E94</td><td style="text-align:center;">\u6570\u5B66</td><td style="text-align:center;">60</td></tr><tr><td style="text-align:center;">...</td><td style="text-align:center;">...</td><td style="text-align:center;">...</td></tr></tbody></table><blockquote><p>\u8981\u6C42\u4EE5\u6BCF\u4E2A\u5B66\u751F\u4E00\u884C\u6570\u636E\u7684\u5F62\u5F0F\u521B\u5EFA\u4EE5\u4E0B\u62A5\u8868\uFF1A</p></blockquote><table><thead><tr><th style="text-align:center;">\u59D3\u540D</th><th style="text-align:center;">\u8BED\u6587</th><th style="text-align:center;">\u6570\u5B66</th><th style="text-align:center;">\u82F1\u8BED</th></tr></thead><tbody><tr><td style="text-align:center;">\u5F20\u4E09</td><td style="text-align:center;">80</td><td style="text-align:center;">85</td><td style="text-align:center;">81</td></tr><tr><td style="text-align:center;">\u674E\u56DB</td><td style="text-align:center;">77</td><td style="text-align:center;">90</td><td style="text-align:center;">69</td></tr><tr><td style="text-align:center;">\u738B\u4E94</td><td style="text-align:center;">91</td><td style="text-align:center;">60</td><td style="text-align:center;">82</td></tr></tbody></table><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>SELECT sname AS &quot;\u59D3\u540D&quot;,
			 sum(CASE cname WHEN &#39;\u8BED\u6587&#39; THEN grade END) AS &quot;\u8BED\u6587&quot;,
			 sum(CASE cname WHEN &#39;\u6570\u5B66&#39; THEN grade END) AS &quot;\u6570\u5B66&quot;,
			 sum(CASE cname WHEN &#39;\u82F1\u8BED&#39; THEN grade END) AS &quot;\u82F1\u8BED&quot;,
			 sum(grade) AS &quot;\u603B\u5206&quot;
FROM t_score ts
GROUP BY sname;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h1 id="sql-\u9762\u8BD5\u9898" tabindex="-1"><a class="header-anchor" href="#sql-\u9762\u8BD5\u9898" aria-hidden="true">#</a> SQL \u9762\u8BD5\u9898</h1><h2 id="\u57FA\u4E8E\u626B\u7801\u8BB0\u5F55-\u67E5\u627E\u5BC6\u63A5\u4EBA\u5458" tabindex="-1"><a class="header-anchor" href="#\u57FA\u4E8E\u626B\u7801\u8BB0\u5F55-\u67E5\u627E\u5BC6\u63A5\u4EBA\u5458" aria-hidden="true">#</a> \u57FA\u4E8E\u626B\u7801\u8BB0\u5F55 \u67E5\u627E\u5BC6\u63A5\u4EBA\u5458</h2><table><thead><tr><th style="text-align:center;">uid</th><th style="text-align:center;">area</th><th style="text-align:center;">scan_time</th></tr></thead><tbody><tr><td style="text-align:center;">130111111</td><td style="text-align:center;">A001</td><td style="text-align:center;">2022-05-01 09:00:00</td></tr><tr><td style="text-align:center;">130111111</td><td style="text-align:center;">A001</td><td style="text-align:center;">2022-05-01 10:00:00</td></tr><tr><td style="text-align:center;">130111111</td><td style="text-align:center;">A001</td><td style="text-align:center;">2022-05-01 11:00:00</td></tr><tr><td style="text-align:center;">130222222</td><td style="text-align:center;">A002</td><td style="text-align:center;">2022-05-01 11:05:00</td></tr><tr><td style="text-align:center;">...</td><td style="text-align:center;">...</td><td style="text-align:center;">...</td></tr></tbody></table><h3 id="\u95EE\u9898\u4E00" tabindex="-1"><a class="header-anchor" href="#\u95EE\u9898\u4E00" aria-hidden="true">#</a> \u95EE\u9898\u4E00</h3><ul><li>\u627E\u51FA\u6BCF\u4E2A\u7528\u6237\u5728\u6BCF\u4E2A\u533A\u57DF\u7684\u884C\u52A8\u8F68\u8FF9</li></ul><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>WITH tmp AS (
SELECT uid, area, scan_time,
	   -- \u626B\u63CF\u65F6\u95F4\u6392\u5E8F - \u533A\u57DF\u5212\u5206\u540E\u626B\u63CF\u65F6\u95F4\u6392\u5E8F
	   ROW_NUMBER() OVER (PARTITION BY scan_time) num1 - ROW_NUMBER() OVER (PARTITION BY scan_time, area ORDER BY scan_time) diff
FROM trail)
SELECT uid, area, min(scan_time) start_time, max(scan_time) end_time
FROM tmp 
GROUP BY uid, area, diff
ORDER BY uid, scan_time;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="\u95EE\u9898\u4E8C" tabindex="-1"><a class="header-anchor" href="#\u95EE\u9898\u4E8C" aria-hidden="true">#</a> \u95EE\u9898\u4E8C</h3><ul><li><p>\u52A0\u5165\u67D0\u4E2A\u7528\u6237\u6838\u9178\u68C0\u67E5\u4E3A\u9633\u6027\uFF0C\u627E\u51FA\u4ED6\u7684\u4F34\u968F\u4EBA\u5458</p><p>\u4F34\u968F\u89C4\u5219\uFF1A\u5728\u9633\u6027\u4EBA\u5458\u505C\u7559\u534A\u5C0F\u65F6\u4EE5\u4E0A\u7684\u533A\u57DF\uFF0C\u7528\u6237\u505C\u7559\u534A\u5C0F\u65F6\u4EE5\u4E0A\uFF0C\u5E76\u4E14\u505C\u7559\u65F6\u95F4\u548C\u9633\u6027\u4EBA\u5458\u6709\u5341\u5206\u949F\u4EE5\u4E0A\u7684\u4EA4\u96C6\u3002</p><p><img src="`+e+`" alt="SQL\u7F16\u7A0B\u601D\u60F3-\u9762\u96BE\u9898-\u67E5\u627E\u5BC6\u63A51"></p></li></ul><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>WITH tmp AS (
SELECT uid, area, scan_time,
	   -- \u626B\u63CF\u65F6\u95F4\u6392\u5E8F - \u533A\u57DF\u5212\u5206\u540E\u626B\u63CF\u65F6\u95F4\u6392\u5E8F
	   ROW_NUMBER() OVER (PARTITION BY scan_time) num1 - ROW_NUMBER() OVER (PARTITION BY scan_time, area ORDER BY scan_time) diff
FROM trail),
tmp2 AS (
SELECT uid, area, min(scan_time) start_time, max(scan_time) end_time
FROM tmp 
GROUP BY uid, area, diff
HAVING min(scan_time) + INTERVAL 30 MINUTE &lt;= max(scan_time)
)
SELECT *
FROM tmp2 u1
JOIN tmp2 u2
ON (u1.uid &lt;&gt; u2.uid AND u1.area = u2.area
	AND u1.start_time + INTERVAL 10 MINUTE &lt;= u2.end_time
	AND u2.start_time + INTERVAL 10 MINUTE &lt;= u1.end_time)
WHERE u1.uid = &quot;13011111111&quot;;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="\u601D\u8003" tabindex="-1"><a class="header-anchor" href="#\u601D\u8003" aria-hidden="true">#</a> \u601D\u8003</h3><ul><li>\u7B97\u51FA\u548C\u5BC6\u63A5\u4EBA\u5458\u63A5\u89E6\u7684\u65F6\u95F4</li></ul>`,27);function l(r,p){return s}var i=t(a,[["render",l],["__file","SQL\u7F16\u7A0B\u601D\u60F3.html.vue"]]);export{i as default};
